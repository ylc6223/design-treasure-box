# 端到端功能测试清单

## 测试环境

- **应用 URL**: http://localhost:3000
- **Supabase 项目**: 已配置
- **测试日期**: 2026-01-17

## 1. 用户认证流程测试

### 1.1 Google OAuth 登录

- [ ] 点击"登录"按钮
- [ ] 选择"使用 Google 登录"
- [ ] 重定向到 Google 授权页面
- [ ] 授权成功后重定向回应用
- [ ] 用户信息正确显示在 Header
- [ ] Profile 自动创建（检查 Supabase profiles 表）
- [ ] 默认角色为 USER

### 1.2 GitHub OAuth 登录

- [ ] 点击"登录"按钮
- [ ] 选择"使用 GitHub 登录"
- [ ] 重定向到 GitHub 授权页面
- [ ] 授权成功后重定向回应用
- [ ] 用户信息正确显示在 Header
- [ ] Profile 自动创建
- [ ] 默认角色为 USER

### 1.3 用户菜单

- [ ] 登录后显示用户头像和名称
- [ ] 点击头像显示下拉菜单
- [ ] 菜单包含：个人资料、我的评分、退出登录
- [ ] 管理员用户显示"管理后台"链接
- [ ] 点击"退出登录"成功登出

### 1.4 会话管理

- [ ] 刷新页面后会话保持
- [ ] 会话过期后自动要求重新登录
- [ ] 登出后无法访问需要认证的功能

## 2. 评分功能测试

### 2.1 查看评分

- [ ] 资源卡片显示评分星星
- [ ] 资源详情页显示评分详情
- [ ] 显示策展人评分（默认）
- [ ] 有用户评分时显示聚合评分
- [ ] 显示评分人数
- [ ] 已登录且已评分时显示用户个人评分

### 2.2 提交评分（未登录）

- [ ] 点击"评分"按钮
- [ ] 提示需要登录
- [ ] 引导用户登录

### 2.3 提交评分（已登录）

- [ ] 点击"评分"按钮打开评分对话框
- [ ] 显示 5 个评分维度输入
- [ ] 支持 0.5 精度（半星）
- [ ] 可选评论文本框
- [ ] 提交评分成功
- [ ] 评分立即显示在界面上
- [ ] 数据保存到 Supabase ratings 表

### 2.4 更新评分

- [ ] 已评分用户点击"修改评分"
- [ ] 对话框显示现有评分
- [ ] 修改评分值
- [ ] 提交更新成功
- [ ] 界面立即更新
- [ ] 数据库中评分更新（不创建新记录）

### 2.5 评分聚合计算

- [ ] 多个用户评分后计算平均值
- [ ] 平均值四舍五入到 0.5
- [ ] 评分人数正确显示
- [ ] 删除评分后重新计算

## 3. 资源管理（管理员功能）

### 3.1 管理员权限验证

- [ ] 非管理员访问 /admin 重定向到首页
- [ ] 管理员可以访问 /admin
- [ ] 管理员菜单显示"管理后台"链接

### 3.2 资源列表

- [ ] 显示所有资源
- [ ] 支持分页
- [ ] 支持搜索（名称、描述）
- [ ] 支持按分类筛选
- [ ] 支持按精选状态筛选
- [ ] 显示编辑和删除按钮

### 3.3 创建资源

- [ ] 点击"新建资源"按钮
- [ ] 填写资源表单（所有必填字段）
- [ ] 策展人评分输入（5 个维度）
- [ ] 提交成功
- [ ] 资源出现在列表中
- [ ] 数据保存到 Supabase resources 表
- [ ] 缩略图自动从 URL 获取

### 3.4 编辑资源

- [ ] 点击"编辑"按钮
- [ ] 表单加载现有数据
- [ ] 修改资源信息
- [ ] 提交更新成功
- [ ] 列表中数据更新
- [ ] 数据库中数据更新

### 3.5 删除资源

- [ ] 点击"删除"按钮
- [ ] 显示确认对话框
- [ ] 确认删除
- [ ] 资源从列表中移除
- [ ] 数据库中资源删除
- [ ] 关联的评分自动删除（级联删除）

## 4. 用户管理（管理员功能）

### 4.1 用户列表

- [ ] 显示所有用户
- [ ] 显示用户信息（名称、邮箱、角色、注册时间）
- [ ] 支持分页
- [ ] 支持搜索

### 4.2 角色管理

- [ ] 显示用户当前角色
- [ ] 点击角色切换按钮
- [ ] USER ↔ ADMIN 切换
- [ ] 角色更新成功
- [ ] 数据库中角色更新
- [ ] 用户权限立即生效

## 5. 前端资源缩略图

### 5.1 图片加载

- [ ] 资源卡片显示缩略图
- [ ] 优先加载 Open Graph 图片
- [ ] OG 图片失败时回退到截图
- [ ] 截图失败时显示占位图
- [ ] 图片支持 lazy loading

### 5.2 性能

- [ ] 图片加载不阻塞页面渲染
- [ ] Microlink API 响应速度正常
- [ ] 图片缓存正常工作

## 6. 错误处理

### 6.1 API 错误

- [ ] 验证错误返回 400 和详细信息
- [ ] 认证错误返回 401
- [ ] 授权错误返回 403
- [ ] 资源不存在返回 404
- [ ] 冲突错误返回 409
- [ ] 服务器错误返回 500

### 6.2 前端错误处理

- [ ] API 错误显示友好提示
- [ ] 网络错误显示重试选项
- [ ] 表单验证错误显示在字段旁
- [ ] 加载状态正确显示

## 7. RLS 策略验证

### 7.1 Profiles 表

- [ ] 所有人可以查看 profiles
- [ ] 用户只能更新自己的 profile
- [ ] 管理员可以更新任何 profile

### 7.2 Resources 表

- [ ] 所有人可以查看 resources
- [ ] 只有管理员可以创建 resources
- [ ] 只有管理员可以更新 resources
- [ ] 只有管理员可以删除 resources

### 7.3 Ratings 表

- [ ] 所有人可以查看 ratings
- [ ] 已登录用户可以创建 ratings
- [ ] 用户只能更新自己的 ratings
- [ ] 用户只能删除自己的 ratings

## 8. 数据完整性

### 8.1 数据验证

- [ ] 评分值在 0-5 范围内
- [ ] 评分精度为 0.5
- [ ] URL 格式正确
- [ ] 必填字段不能为空
- [ ] 唯一约束正常工作（user_id, resource_id）

### 8.2 级联删除

- [ ] 删除资源时自动删除关联评分
- [ ] 删除用户时自动删除关联评分

## 9. 性能测试

### 9.1 页面加载

- [ ] 首页加载时间 < 2 秒
- [ ] 资源详情页加载时间 < 1.5 秒
- [ ] 管理后台加载时间 < 2 秒

### 9.2 API 响应

- [ ] 资源列表 API < 500ms
- [ ] 评分提交 API < 300ms
- [ ] 评分查询 API < 200ms

### 9.3 缓存

- [ ] TanStack Query 缓存正常工作
- [ ] 数据更新后缓存失效
- [ ] 缓存过期后自动重新获取

## 10. 浏览器兼容性

### 10.1 桌面浏览器

- [ ] Chrome（最新版）
- [ ] Firefox（最新版）
- [ ] Safari（最新版）
- [ ] Edge（最新版）

### 10.2 移动浏览器

- [ ] iOS Safari
- [ ] Android Chrome

## 测试结果

### 通过的测试

- 记录通过的测试项

### 失败的测试

- 记录失败的测试项和错误信息

### 待修复的问题

- 列出需要修复的问题

## 测试总结

### 整体评估

- [ ] 所有核心功能正常工作
- [ ] 所有 API 端点正常工作
- [ ] 所有 RLS 策略正确执行
- [ ] 性能符合预期
- [ ] 错误处理完善

### 建议

- 列出改进建议
