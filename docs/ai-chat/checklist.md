# AI 聊天助手开发检查清单

**基于文档**: `ai-chat-implementation-plan.md`
**创建日期**: 2026-01-22
**最后更新**: YYYY-MM-DD
**当前阶段**: Phase 0

---

## 📊 进度概览

| 阶段    | 状态      | 完成度 | 开始日期 | 完成日期 | 负责人  |
| ------- | --------- | ------ | -------- | -------- | ------- |
| Phase 0 | ⏳ 待开始 | 0%     | -        | -        | @待分配 |
| Phase 1 | ⏳ 待开始 | 0%     | -        | -        | @待分配 |
| Phase 2 | ⏳ 待开始 | 0%     | -        | -        | @待分配 |
| Phase 3 | ⏳ 待开始 | 0%     | -        | -        | @待分配 |
| Phase 4 | ⏳ 待开始 | 0%     | -        | -        | @待分配 |
| Phase 5 | ⏳ 待开始 | 0%     | -        | -        | @待分配 |

**状态说明**:

- ⏳ 待开始
- 🔄 进行中
- ⚠️ 阻塞
- ✅ 完成
- ❌ 已取消

---

## Phase 0: 前期准备与基础设施

### 0.1 环境配置与依赖安装

- [ ] 安装智谱AI SDK依赖 (`pnpm add zhipu-ai-provider @ai-sdk/react`)
- [ ] 配置环境变量 (`.env.local`)
  - [ ] ZHIPU_AI_API_KEY
  - [ ] ZHIPU_AI_MODEL=glm-4-plus
  - [ ] ZHIPU_AI_EMBEDDING_MODEL=embedding-3
  - [ ] ENABLE_STREAMING=true
- [ ] 创建AI配置文件 `lib/ai/config.ts`
- [ ] 验证API连接性（测试脚本）
- [ ] 确认环境变量已加入`.gitignore`

**验收**:

- [ ] API密钥配置正确，能够成功调用智谱AI接口
- [ ] embedding和文本生成接口均测试通过
- [ ] 环境变量不包含敏感信息

---

### 0.2 数据准备与向量化

- [ ] 审查现有资源数据 (`data/resources.json` 或 Supabase)
- [ ] 确保每个资源包含必要的元数据
  - [ ] `id`, `title`, `description` 已存在
  - [ ] `category`, `tags`, `style` 已存在
  - [ ] `color`, `industry` (如有) 已存在
  - [ ] `imageUrl`, `url`, `rating` 已存在
- [ ] 编写向量化脚本 `scripts/generate-embeddings.ts`
- [ ] 批量生成所有资源的embedding向量
- [ ] 存储embedding到数据库/JSON文件
- [ ] 验证embedding质量（相似度检索测试）

**验收**:

- [ ] 所有资源均有有效的embedding向量
- [ ] 相似资源的检索结果符合直觉（如"蓝色网站"能找到蓝色系网站）
- [ ] embedding存储方案可扩展（支持增量更新）

---

### 0.3 API路由搭建

- [ ] 创建API路由 `app/api/chat/route.ts`
- [ ] 实现基础请求处理框架
- [ ] 配置错误处理中间件
- [ ] 添加请求日志记录
- [ ] 实现速率限制（可选）

**验收**:

- [ ] API路由可正常接收和响应请求
- [ ] 错误处理能够优雅降级
- [ ] 请求日志记录完整

---

### 0.4 类型定义与Schema验证

- [ ] 审查并完善 `types/ai-chat.ts`
- [ ] 确保所有类型与API接口一致
  - [ ] `ChatRequest` 类型
  - [ ] `ChatResponse` 类型
  - [ ] `QueryAnalysis` 类型
  - [ ] `SearchResult` 类型
  - [ ] `ClarificationQuestion` 类型
- [ ] 编写Zod验证schema
- [ ] 添加运行时类型检查到API路由

**验收**:

- [ ] 所有API请求都经过Zod验证
- [ ] 类型错误在开发期能被捕获
- [ ] 类型定义与文档一致

---

**Phase 0 总验收**:

- [ ] 开发环境配置完成，可以开始功能开发
- [ ] 所有资源已向量化并可检索
- [ ] API基础框架可正常工作
- [ ] 类型系统完善，开发时无类型错误

**状态**: ⏳ 待开始 | **完成度**: 0% | **负责人**: @待分配

---

## Phase 1: 核心搜索与推荐引擎

### 1.1 意图识别引擎 (Query Analyzer)

- [ ] 创建 `lib/ai/query-analyzer.ts`
- [ ] 实现关键词密度计算
  - [ ] 停用词过滤（的、是、网站...）
  - [ ] 有效关键词提取
  - [ ] 密度等级判定（低/中/高）
- [ ] 实现核心维度识别
  - [ ] 类别/行业关键词库
  - [ ] 风格关键词库（极简、复古...）
  - [ ] 颜色关键词库
  - [ ] 受众关键词库（B2B、年轻...）
- [ ] 实现清晰度判定逻辑
- [ ] 编写单元测试（覆盖率 ≥ 80%）
  - [ ] 测试"蓝色" → 极度模糊
  - [ ] 测试"蓝色 电商" → 意图清晰
  - [ ] 测试所有文档场景

**验收**:

- [ ] 文档中的所有场景都能正确判定
- [ ] 单元测试覆盖率 ≥ 80%
- [ ] 处理时间 < 100ms（不包含AI调用）

---

### 1.2 向量搜索引擎 (Vector Search Engine)

- [ ] 创建 `lib/ai/vector-search.ts`
- [ ] 实现查询向量化
  - [ ] 调用智谱AI embedding-3模型
  - [ ] 添加缓存（相同查询24小时内复用）
- [ ] 实现相似度计算
  - [ ] 余弦相似度算法
  - [ ] 返回0-1的分数
- [ ] 实现Top-K检索
  - [ ] 应用筛选条件（类别、评分...）
  - [ ] 按相似度排序
  - [ ] 返回Top-K结果
- [ ] 实现筛选条件逻辑
  - [ ] `categories`: 类别筛选
  - [ ] `minRating`: 最低评分
  - [ ] `excludeIds`: 排除已展示的资源
- [ ] 性能优化（如果资源数 > 1000）
  - [ ] 考虑使用向量数据库（如Pinecone、Weaviate）
  - [ ] 或实现HNSW索引

**验收**:

- [ ] 向量搜索准确率符合预期（主观评测）
- [ ] 检索速度 < 500ms（1000个资源）
- [ ] 筛选条件正确应用
- [ ] 边界情况处理正确（零结果、极端查询）

---

### 1.3 AI推荐生成引擎 (Recommendation Engine)

- [ ] 创建 `lib/ai/recommendation-engine.ts`
- [ ] 实现推荐理由生成
  - [ ] 为每个结果生成1-2句话的推荐理由
  - [ ] 说明"为什么匹配"（颜色、风格、行业...）
  - [ ] 控制生成成本（每条 ≤ 50字）
- [ ] 实现匹配度计算
  - [ ] 综合考虑相似度和维度匹配度
  - [ ] 返回0-100的分数
- [ ] 实现短路逻辑（L1/L2切换）
  - [ ] 简单查询用L1（纯向量检索）
  - [ ] 复杂查询用L2（RAG + 生成）
- [ ] 实现智能约束放松（Phase 1简化版）
  - [ ] 如果结果 < 3个，逐步放宽筛选条件
  - [ ] 先放宽类别，再放宽风格，最后放宽评分

**验收**:

- [ ] 推荐理由"说人话"，解释清晰
- [ ] L1/L2切换逻辑正确
- [ ] 简单查询响应 < 1s，复杂查询 < 2s
- [ ] AI成本控制在预期范围内

---

### 1.4 API集成与端到端测试

- [ ] 整合所有模块到 `app/api/chat/route.ts`
  - [ ] 意图识别
  - [ ] 向量搜索 + AI生成
  - [ ] 构建响应
- [ ] 实现响应文本生成
- [ ] 添加请求/响应日志（用于调试）
- [ ] 编写端到端集成测试
- [ ] 手动测试常见场景（至少10个）
  - [ ] "蓝色" （极度模糊）
  - [ ] "蓝色 简约" （中等模糊）
  - [ ] "蓝色 电商" （意图清晰）
  - [ ] "蓝色 简约 电商" （精准查询）
  - [ ] "紫色蒸汽朋克宠物医院" （零结果）
  - [ ] "最近流行的设计风格" （模糊探索）
  - [ ] ... 更多场景

**验收**:

- [ ] 所有文档场景都能正常工作
- [ ] API响应格式符合规范
- [ ] 错误情况优雅降级
- [ ] 集成测试通过

---

**Phase 1 总验收**:

- [ ] 意图识别准确率 ≥ 85%（人工抽测100个查询）
- [ ] 推荐相关性 ≥ 4.0/5.0（用户评分）
- [ ] API平均响应时间 < 2s
- [ ] 零结果处理合理（有近似推荐）
- [ ] 代码覆盖率 ≥ 75%

**状态**: ⏳ 待开始 | **完成度**: 0% | **负责人**: @待分配

---

## Phase 2: 智能交互与澄清系统

### 2.1 澄清问题生成器 (Clarification Generator)

- [ ] 创建 `lib/ai/clarification-generator.ts`
- [ ] 实现缺失维度检测
- [ ] 实现澄清问题生成
  - [ ] 为每个缺失维度生成1个问题
  - [ ] 提供2-4个预设选项
  - [ ] 问题自然、友好
- [ ] 实现澄清策略选择
  - [ ] 高模糊 → batch（批量澄清）
  - [ ] 中等模糊 → single（单次澄清）
  - [ ] 低模糊 → suggestion（非侵入式建议）
- [ ] 编写单元测试

**验收**:

- [ ] 澄清问题自然易懂（用户研究验证）
- [ ] 选项覆盖常见情况
- [ ] 生成时间 < 1s

---

### 2.2 会话记忆管理 (Session Memory)

- [ ] 扩展 `hooks/use-ai-chat.ts`
- [ ] 实现会话内偏好记忆
  - [ ] categories 记忆
  - [ ] styles 记忆
  - [ ] excludedStyles 记忆
  - [ ] colorPreferences 记忆
- [ ] 实现反馈记录
- [ ] 实现记忆应用
- [ ] 验证会话持久化（现有功能）
- [ ] 测试记忆功能（5+场景）

**验收**:

- [ ] 会话内偏好正确应用
- [ ] 记忆不影响新会话
- [ ] 用户可以重置偏好

---

### 2.3 前端聊天UI (Chat Interface)

- [ ] 审查现有 `components/ai-chat-interface.tsx`
- [ ] 实现骨架屏组件
  - [ ] 创建 `components/ai-chat/skeleton-card.tsx`
  - [ ] 实现4-6个骨架卡片布局
  - [ ] 添加脉冲动画
- [ ] 实现资源卡片组件
  - [ ] 创建 `components/ai-chat/resource-card.tsx`
  - [ ] 显示：缩略图、标题、评分、AI推荐语
  - [ ] 添加快速操作：收藏、预览、访问
  - [ ] 添加hover效果和微交互
- [ ] 实现澄清问题组件（已有，验证可用）
- [ ] 实现三阶段加载逻辑
- [ ] 优化动画和过渡效果（使用Motion）

**验收**:

- [ ] UI符合设计规范（参考文档第13章）
- [ ] 三阶段加载流畅，无CLS问题
- [ ] 移动端和桌面端表现一致
- [ ] 无性能问题（60fps）

---

### 2.4 迭代优化功能 (Iterative Refinement)

- [ ] 实现迭代指令识别
- [ ] 实现基于结果的扩展搜索
- [ ] 实现排除式搜索
- [ ] UI：在每组结果末尾添加迭代入口
  - [ ] "不喜欢这组？告诉我调整方向"
  - [ ] 快捷指令按钮

**验收**:

- [ ] 迭代指令识别准确率 ≥ 90%
- [ ] 迭代后的结果符合用户预期
- [ ] UI引导清晰，用户知道如何使用

---

**Phase 2 总验收**:

- [ ] 澄清问题生成合理（用户测试 ≥ 5人）
- [ ] 会话记忆正确工作（10+测试场景）
- [ ] 前端UI完整可用，无重大bug
- [ ] 迭代优化功能正常工作
- [ ] 代码覆盖率 ≥ 70%

**状态**: ⏳ 待开始 | **完成度**: 0% | **负责人**: @待分配

---

## Phase 3: 体验增强与优化

### 3.1 零结果智能处理 (Zero Result Handling)

- [ ] 创建 `lib/ai/constraint-relaxation.ts`
- [ ] 实现维度拆解推荐
  - [ ] 尝试 A+B, B+C, A+C 的组合
  - [ ] 返回分组结果
- [ ] 实现语义关联拓展
  - [ ] "蒸汽朋克" → ["工业风", "复古机械"...]
  - [ ] 使用AI生成关联词
- [ ] 实现可删除标签UI
  - [ ] 在结果顶部展示搜索条件
  - [ ] 支持点击删除标签
  - [ ] 删除后自动刷新结果
- [ ] 测试零结果场景（10+个）

**验收**:

- [ ] 零结果场景都有近似推荐
- [ ] 维度拆解合理
- [ ] 语义拓展准确

---

### 3.2 新用户引导系统 (User Onboarding)

- [ ] 实现人性化开场
  - [ ] AI Logo + 场景化文案
  - [ ] 文案： "嗨！设计灵感枯竭了？..."
- [ ] 实现一键提问按钮
  - [ ] 3-4个预设问题（带emoji）
  - [ ] 随机轮换内容
  - [ ] 点击即发送
- [ ] 实现Mad Libs填空式引导
  - [ ] "我想找一个 [风格] 的 [行业] 网站..."
  - [ ] 点击标签弹出选项
  - [ ] 自动填入输入框
- [ ] 实现Placeholder动效
  - [ ] 自动打字演示
  - [ ] 循环播放多个示例
- [ ] A/B测试引导方式（可选）

**验收**:

- [ ] 新用户能够在10秒内完成第一次提问
- [ ] 引导不干扰老用户（只显示一次）
- [ ] 用户学习曲线平缓

---

### 3.3 性能优化与监控

- [ ] 实现查询缓存
  - [ ] LRU缓存（100条，24小时TTL）
- [ ] 优化embedding生成
  - [ ] 批量生成
  - [ ] 结果持久化到数据库
- [ ] 实现流式响应（可选）
- [ ] 添加性能监控
  - [ ] API响应时间
  - [ ] AI成本追踪
  - [ ] 错误率统计
- [ ] 添加用户分析（可选）
  - [ ] 使用率统计
  - [ ] 满意度收集

**验收**:

- [ ] 缓存命中率 ≥ 30%
- [ ] 平均响应时间减少 20%
- [ ] AI成本控制在预算内

---

**Phase 3 总验收**:

- [ ] 零结果场景全覆盖，无空手而归
- [ ] 新用户引导完成率 ≥ 60%
- [ ] 性能指标达标（LCP < 1.5s, FID < 100ms）
- [ ] 监控系统正常工作

**状态**: ⏳ 待开始 | **完成度**: 0% | **负责人**: @待分配

---

## Phase 4: 移动端适配与手势优化

### 4.1 移动端全屏模式

- [ ] 审查移动端现有实现
- [ ] 优化全屏聊天UI
  - [ ] 确保占满整个屏幕
  - [ ] 隐藏不必要的装饰元素
  - [ ] 优化触摸目标尺寸（≥44x44px）
- [ ] 实现手势返回
  - [ ] 右滑返回
  - [ ] 下拉关闭
- [ ] 优化虚拟键盘处理
  - [ ] 输入时自动调整布局
  - [ ] 键盘弹出时保持输入框可见

**验收**:

- [ ] 移动端无布局问题
- [ ] 手势操作流畅
- [ ] 键盘交互自然

---

### 4.2 手势交互与卡片操作

- [ ] 实现卡片滑动查看
  - [ ] 横向滑动切换资源
  - [ ] 纵向滑动查看更多
- [ ] 实现长按批量选择
  - [ ] 长按进入选择模式
  - [ ] 支持批量收藏
- [ ] 实现分组切换手势
  - [ ] 左右滑动切换分组
  - [ ] 视觉反馈清晰
- [ ] 优化触摸反馈
  - [ ] 点击态样式
  - [ ] 触觉反馈（如支持）

**验收**:

- [ ] 手势识别准确率 ≥ 95%
- [ ] 无误触问题
- [ ] 移动端体验优于桌面端

---

### 4.3 响应式布局优化

- [ ] 调整泳道方向
  - [ ] 桌面端：横向泳道
  - [ ] 移动端：纵向泳道
- [ ] 优化资源卡片布局
  - [ ] 移动端：单列布局
  - [ ] 平板：1-2列布局
  - [ ] 桌面：2-3列布局
- [ ] 优化字体和间距
  - [ ] 移动端字体增大
  - [ ] 间距适配触摸
- [ ] 测试不同设备
  - [ ] iPhone SE (375px)
  - [ ] iPhone 14 Pro (393px)
  - [ ] iPad (768px)
  - [ ] Desktop (1920px)

**验收**:

- [ ] 所有断点下表现良好
- [ ] 无横向滚动问题
- [ ] 响应式测试通过

---

**Phase 4 总验收**:

- [ ] 移动端体验完整可用
- [ ] 手势操作流畅
- [ ] 响应式适配全面
- [ ] 移动端用户满意度 ≥ 4.0/5.0

**状态**: ⏳ 待开始 | **完成度**: 0% | **负责人**: @待分配

---

## Phase 5: 测试、优化与上线

### 5.1 功能测试

- [ ] 单元测试
  - [ ] 意图识别引擎（覆盖率 ≥ 80%）
  - [ ] 向量搜索引擎（覆盖率 ≥ 75%）
  - [ ] 推荐生成引擎（覆盖率 ≥ 70%）
  - [ ] 澄清问题生成器（覆盖率 ≥ 75%）
- [ ] 集成测试
  - [ ] API端到端测试（10+场景）
  - [ ] 前端组件测试（核心组件）
- [ ] 用户测试
  - [ ] 招募5-10名测试用户
  - [ ] 完成典型任务（10个场景）
  - [ ] 收集反馈和bug

**验收**:

- [ ] 单元测试通过率 100%
- [ ] 集成测试通过率 100%
- [ ] 用户任务完成率 ≥ 80%
- [ ] 阻塞性bug = 0

---

### 5.2 性能测试与优化

- [ ] 负载测试
  - [ ] 10并发用户
  - [ ] 100并发用户
  - [ ] 监控响应时间和错误率
- [ ] 性能优化
  - [ ] 优化慢查询（> 2s）
  - [ ] 减少不必要的重渲染
  - [ ] 图片懒加载和优化
- [ ] Web Vitals优化
  - [ ] FCP < 0.5s
  - [ ] LCP < 1.5s
  - [ ] CLS < 0.1
- [ ] AI成本优化
  - [ ] 分析token使用情况
  - [ ] 优化prompt长度
  - [ ] 启用缓存

**验收**:

- [ ] 所有Web Vitals达标
- [ ] API p95响应时间 < 2s
- [ ] AI成本/查询 < ¥0.05

---

### 5.3 文档与部署

- [ ] 完善文档
  - [ ] API文档（使用方式、参数说明）
  - [ ] 用户使用指南
  - [ ] 开发者维护文档
- [ ] 部署准备
  - [ ] 配置生产环境变量
  - [ ] 设置监控和告警
  - [ ] 准备回滚方案
- [ ] 灰度发布
  - [ ] 先发布给10%用户
  - [ ] 监控错误率和性能
  - [ ] 逐步扩大到100%
- [ ] 发布公告
  - [ ] 产品更新日志
  - [ ] 用户引导教程
  - [ ] 功能演示视频（可选）

**验收**:

- [ ] 文档完整准确
- [ ] 部署流程顺畅
- [ ] 灰度期间无重大问题

---

**Phase 5 总验收**:

- [ ] 所有测试通过
- [ ] 性能指标达标
- [ ] 文档完善
- [ ] 成功部署到生产环境
- [ ] 用户反馈积极

**状态**: ⏳ 待开始 | **完成度**: 0% | **负责人**: @待分配

---

## 📋 总体检查清单

### 开发完成度

- [ ] **Phase 0**: 前期准备 ✅
- [ ] **Phase 1**: 核心引擎 ✅
- [ ] **Phase 2**: 智能交互 ✅
- [ ] **Phase 3**: 体验增强 ✅
- [ ] **Phase 4**: 移动端 ✅
- [ ] **Phase 5**: 测试上线 ✅

---

### 质量指标

#### 代码质量

- [ ] TypeScript严格模式无错误
- [ ] ESLint无警告
- [ ] 单元测试覆盖率 ≥ 75%
- [ ] 代码审查完成

#### 性能指标

- [ ] FCP < 0.5s
- [ ] LCP < 1.5s
- [ ] CLS < 0.1
- [ ] API p95 < 2s

#### 用户体验

- [ ] 用户测试通过率 ≥ 80%
- [ ] 满意度评分 ≥ 4.0/5.0
- [ ] 阻塞性bug = 0
- [ ] 可访问性达标（WCAG AA）

#### 成本控制

- [ ] AI成本/查询 < ¥0.05
- [ ] 月度AI成本在预算内
- [ ] 缓存命中率 ≥ 30%

---

### 文档完善

#### 技术文档

- [ ] API文档完整
- [ ] 架构设计文档
- [ ] 数据模型文档

#### 用户文档

- [ ] 使用指南
- [ ] FAQ文档
- [ ] 视频教程（可选）

#### 运维文档

- [ ] 部署文档
- [ ] 监控配置
- [ ] 应急预案

---

## 📝 更新日志

| 日期       | 更新内容                   | 更新人    |
| ---------- | -------------------------- | --------- |
| 2026-01-22 | 初始版本，提取所有检查清单 | @Claude   |
| YYYY-MM-DD | [填写更新内容]             | @你的名字 |

---

## 📌 使用说明

### 如何使用这个检查清单

1. **每日工作开始前**：
   - 查看当前阶段的任务列表
   - 确认今天要完成的checkbox

2. **完成一个任务后**：
   - 勾选对应的 `[ ]` → `[x]`
   - 更新进度概览表中的完成度

3. **完成一个阶段后**：
   - 确认该阶段的所有总验收项都已勾选
   - 更新进度概览表中的状态和完成日期
   - 在README.md的进度追踪部分更新状态

4. **每周五下午**：
   - 全面审查进度
   - 更新整体完成度
   - 记录下周计划

---

**最后更新**: 2026-01-22
**下次审查**: 每周五下午进行进度检查
