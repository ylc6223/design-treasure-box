# AI 聊天 MVP 开发检查清单

**基于文档**: `technical-specification.md` + `MVP-KICKOFF.md`
**MVP范围**: 4-5周核心功能
**创建日期**: 2026-01-23
**最后更新**: YYYY-MM-DD
**当前状态**: 🚀 准备启动

---

## 📊 MVP 进度概览

| 周     | 阶段                 | 状态      | 完成度 | 开始日期   | 完成日期 | 负责人 |
| ------ | -------------------- | --------- | ------ | ---------- | -------- | ------ |
| Week 1 | 核心引擎 - 意图识别  | ⏳ 待开始 | 0%     | YYYY-MM-DD | -        | @你    |
| Week 2 | 核心引擎 - 澄清+缓存 | ⏳ 待开始 | 0%     | -          | -        | @你    |
| Week 3 | 智能交互 - 前端UI    | ⏳ 待开始 | 0%     | -          | -        | @你    |
| Week 4 | 集成测试 + 优化      | ⏳ 待开始 | 0%     | -          | -        | @你    |
| Week 5 | **缓冲周**           | ⏳ 待开始 | 0%     | -          | -        | @你    |

**状态说明**:

- ⏳ 待开始
- 🔄 进行中
- ⚠️ 阻塞
- ✅ 完成
- ❌ 已取消
- 🔥 阻塞/延期

**总体进度**: █░░░░░░░░ 0% (0/4 周)

---

## Week 1: 核心引擎 - 意图识别与向量搜索

**目标**: 实现基础的意图分析和向量搜索功能

### Day 1-2: 环境验证 + 框架搭建

#### ✅ 任务1.1: 验证开发环境

- [ ] 启动开发服务器 `npm run dev`
- [ ] 验证 Supabase 连接正常
- [ ] 检查现有AI相关文件
  - [ ] `lib/ai/rag-engine.ts` 存在
  - [ ] `lib/ai/hybrid-search.ts` 存在
  - [ ] `app/api/chat/route.ts` 存在
  - [ ] `hooks/use-ai-chat.ts` 存在
- [ ] 运行现有代码无错误

**验收**:

- [ ] ✅ 开发服务器启动成功
- [ ] ✅ 能访问资源列表页面
- [ ] ✅ 控制台无红色错误

---

#### ✅ 任务1.2: 创建意图分析器骨架

**文件**: `lib/ai/query-analyzer.ts`

- [ ] 创建文件 `lib/ai/query-analyzer.ts`
- [ ] 定义核心类型
  ```typescript
  export interface QueryAnalysis {
    intent: 'search' | 'inspiration' | 'correction' | 'blocked';
    confidence: number;
    dimensions: SearchDimensions;
    clarity: 'clear' | 'ambiguous' | 'vague';
    requiresClarification: boolean;
  }
  ```
- [ ] 实现 `analyzeQuery()` 函数骨架
- [ ] 实现 `calculateKeywordDensity()` 函数
- [ ] 实现 `classifyIntent()` 函数
- [ ] TypeScript 编译无错误

**验收**:

- [ ] ✅ 文件创建成功
- [ ] ✅ TypeScript 类型检查通过
- [ ] ✅ 能导出 `analyzeQuery` 函数

---

#### ✅ 任务1.3: 编写第一个测试

**文件**: `lib/ai/__tests__/query-analyzer.test.ts`

- [ ] 创建测试文件
- [ ] 编写至少4个测试用例
  - [ ] 测试简单查询分析
  - [ ] 测试纠正意图检测
  - [ ] 测试探索意图检测
  - [ ] 测试低置信度触发澄清
- [ ] 运行测试 `npm test`
- [ ] 至少2个测试通过

**验收**:

- [ ] ✅ 测试文件创建成功
- [ ] ✅ 至少2个测试通过
- [ ] ✅ 了解如何运行测试

---

### Day 3-4: 实现核心逻辑

#### ✅ 任务1.4: 实现关键词密度计算

- [ ] 实现词汇分割逻辑
- [ ] 过滤停用词（的、了、是等）
- [ ] 统计有效关键词数量
- [ ] 返回密度评级 (low/medium/high)
- [ ] 编写单元测试

**验收**:

- [ ] ✅ "医疗图标" → medium
- [ ] ✅ "图标" → low
- [ ] ✅ "红色 3D 医疗 行业 图标" → high
- [ ] ✅ 所有测试通过

---

#### ✅ 任务1.5: 实现意图分类

- [ ] 实现基于规则的意图检测
  - [ ] 纠正关键词: 不是、不要、不对、换个
  - [ ] 探索关键词: 灵感、推荐、看看、有什么
  - [ ] 默认: search
- [ ] 处理特殊情况（空输入、纯符号）
- [ ] 编写单元测试

**验收**:

- [ ] ✅ "不对，要红色的" → correction
- [ ] ✅ "给我一些灵感" → inspiration
- [ ] ✅ "医疗图标" → search
- [ ] ✅ 边界情况处理正确

---

#### ✅ 任务1.6: 实现基础维度提取

**方法**: 先用简单规则，后续优化为AI

- [ ] 定义行业关键词库
  ```typescript
  const INDUSTRY_KEYWORDS = ['医疗', '金融', '教育', '电商', 'SaaS'];
  ```
- [ ] 定义风格关键词库
  ```typescript
  const STYLE_KEYWORDS = ['极简', '3D', '扁平', '手绘', '渐变'];
  ```
- [ ] 实现关键词匹配逻辑
- [ ] 编写单元测试

**验收**:

- [ ] ✅ "医疗图标" → { industry: '医疗' }
- [ ] ✅ "极简3D图标" → { style: '极简', type: '3D' }
- [ ] ✅ 匹配逻辑正确

---

### Day 5: 集成与验证

#### ✅ 任务1.7: 集成到RAG引擎

**文件**: `lib/ai/rag-engine.ts`

- [ ] 导入 `query-analyzer.ts`
- [ ] 在 `searchResources()` 中调用 `analyzeQuery()`
- [ ] 根据意图调整搜索策略
  - [ ] 纠正意图: 重新搜索
  - [ ] 探索意图: 增加多样性
- [ ] 测试端到端流程

**验收**:

- [ ] ✅ API能返回分析结果
- [ ] ✅ 不同意图有不同处理
- [ ] ✅ 手动测试通过

---

#### ✅ 任务1.8: 验证向量搜索

**文件**: `lib/ai/test-vector-search.ts`

- [ ] 创建测试脚本
- [ ] 测试简单查询: "医疗图标"
- [ ] 验证返回结果数量 (>0)
- [ ] 检查结果相关性
- [ ] 记录性能指标

**验收**:

- [ ] ✅ 向量搜索返回结果
- [ ] ✅ 结果相关性 > 70% (人工判断)
- [ ] ✅ 响应时间 < 2秒

---

### Week 1 最终验收

#### ✅ Week 1 必达目标

- [ ] `query-analyzer.ts` 实现完成
- [ ] 至少5个单元测试通过
- [ ] 向量搜索能返回结果
- [ ] API能处理基础查询
- [ ] 更新此checklist，勾选所有完成项

#### ✅ Week 1 理想目标

- [ ] 意图识别准确率 > 70%
- [ ] 支持3种意图 (search/correction/inspiration)
- [ ] 响应时间 < 1.5秒 (p95)
- [ ] 代码覆盖率 > 60%

---

## Week 2: 核心引擎 - 澄清策略 + 缓存系统

**目标**: 实现智能澄清和基础缓存

### Day 1-2: 澄清问题生成

#### ✅ 任务2.1: 创建澄清生成器

**文件**: `lib/ai/clarification-generator.ts`

- [ ] 创建文件
- [ ] 实现 `generateClarificationQuestions()` 函数
- [ ] 基于缺失维度生成问题
  ```typescript
  // 示例: "图标" → 缺少行业、风格
  // 生成: "用在什么行业？" "喜欢什么风格？"
  ```
- [ ] 限制问题数量 (最多3个)
- [ ] 编写单元测试

**验收**:

- [ ] ✅ 低置信度查询触发澄清
- [ ] ✅ 生成问题数量合理 (1-3个)
- [ ] ✅ 问题表述清晰

---

#### ✅ 任务2.2: 实现批量澄清模式

- [ ] 设计澄清问题数据结构
- [ ] 实现批量问题生成
- [ ] 添加快速回复选项
- [ ] 前端展示组件（基础版）

**验收**:

- [ ] ✅ 用户能一次看到所有问题
- [ ] ✅ 能点击快速回复
- [ ] ✅ 选择后更新搜索上下文

---

### Day 3-4: 零结果处理

#### ✅ 任务2.3: 实现零结果预防

**文件**: `lib/ai/zero-result-prevention.ts`

- [ ] 创建文件
- [ ] 实现搜索预览逻辑
- [ ] 生成维度放宽建议
  ```typescript
  // "红色 3D 医疗 线性 图标" (无结果)
  // 建议: 去掉 "线性" 或 "医疗"
  ```
- [ ] 返回用户友好的提示

**验收**:

- [ ] ✅ 能检测零结果情况
- [ ] ✅ 提供建设性建议
- [ ] ✅ 用户能应用建议

---

#### ✅ 任务2.4: 实现维度放宽

- [ ] 编写维度组合逻辑
  - [ ] A+B+C → A+B, B+C, A+C
- [ ] 测试放宽后的搜索
- [ ] 比较结果数量
- [ ] 选择最佳放宽方案

**验收**:

- [ ] ✅ 放宽后返回结果
- [ ] ✅ 结果相关性可接受
- [ ] ✅ 性能影响 < 20%

---

### Day 5: 缓存系统

#### ✅ 任务2.5: 实现L1查询缓存

**文件**: `lib/ai/cache-manager.ts`

- [ ] 创建文件
- [ ] 实现简单的内存缓存
  ```typescript
  const cache = new Map<string, SearchResult>();
  ```
- [ ] 实现缓存读写逻辑
- [ ] 设置TTL (1小时)
- [ ] 编写单元测试

**验收**:

- [ ] ✅ 相同查询返回缓存结果
- [ ] ✅ 缓存命中时速度提升 > 50%
- [ ] ✅ 缓存过期逻辑正确

---

#### ✅ 任务2.6: 集成缓存到API

- [ ] 在 `app/api/chat/route.ts` 中集成缓存
- [ ] 记录缓存命中率
- [ ] 添加缓存日志
- [ ] 性能测试

**验收**:

- [ ] ✅ 缓存正常工作
- [ ] ✅ 命中率 > 30%
- [ ] ✅ 响应时间改善明显

---

### Week 2 最终验收

#### ✅ Week 2 必达目标

- [ ] 澄清功能能生成问题
- [ ] 零结果时有建议
- [ ] 基础缓存系统工作
- [ ] 至少3个新测试通过

#### ✅ Week 2 理想目标

- [ ] 澄清准确率 > 80%
- [ ] 零结果率 < 10%
- [ ] 缓存命中率 > 40%
- [ ] API响应时间 < 1秒 (缓存命中)

---

## Week 3: 智能交互 - 前端UI升级

**目标**: 实现泳道分组、骨架屏、澄清UI

### Day 1-2: 泳道式分组

#### ✅ 任务3.1: 创建泳道组织器

**文件**: `lib/ai/swimlane-organizer.ts`

- [ ] 创建文件
- [ ] 实现 `organizeIntoSwimlanes()` 函数
- [ ] 实现简单的分组逻辑
  - [ ] 按风格分组 (极简/3D/扁平)
  - [ ] 每组至少3个资源
- [ ] 处理跨类别资源

**验收**:

- [ ] ✅ 结果能按泳道分组
- [ ] ✅ 泳道标签正确
- [ ] ✅ 资源分布合理

---

#### ✅ 任务3.2: 创建泳道UI组件

**文件**: `components/ai-chat/swimlane-group.tsx`

- [ ] 创建组件文件
- [ ] 实现泳道容器
- [ ] 实现泳道标题
- [ ] 实现横向滚动
- [ ] 添加响应式布局

**验收**:

- [ ] ✅ UI渲染正确
- [ ] ✅ 移动端滚动流畅
- [ ] ✅ 样式符合设计规范

---

### Day 3-4: 骨架屏

#### ✅ 任务3.3: 创建骨架屏组件

**文件**: `components/ai-chat/skeleton-card-grid.tsx`

- [ ] 创建文件
- [ ] 实现标准骨架卡片
  - [ ] 矩形占位符
  - [ ] 动画效果 (shimmer)
- [ ] 实现骨架网格
  - [ ] 2行 × 4列布局
- [ ] 添加加载状态切换

**验收**:

- [ ] ✅ 加载时显示骨架屏
- [ ] ✅ 动画流畅
- [ ] ✅ 数据加载后平滑切换

---

#### ✅ 任务3.4: 集成渐进式加载

- [ ] 修改API返回流式数据
- [ ] 先返回骨架
- [ ] 再返回真实数据
- [ ] 测试加载体验

**验收**:

- [ ] ✅ 用户感知加载速度提升
- [ ] ✅ 无明显布局偏移 (CLS < 0.1)
- [ ] ✅ FCP < 1秒

---

### Day 5: 澄清UI

#### ✅ 任务3.5: 创建澄清消息组件

**文件**: `components/ai-chat/clarification-message.tsx` (增强现有)

- [ ] 审查现有组件
- [ ] 添加批量澄清模式
- [ ] 添加快速回复按钮
- [ ] 添加选择后反馈
- [ ] 样式优化

**验收**:

- [ ] ✅ 问题展示清晰
- [ ] ✅ 点击反馈即时
- [ ] ✅ 移动端友好

---

### Week 3 最终验收

#### ✅ Week 3 必达目标

- [ ] 泳道分组能展示
- [ ] 骨架屏正常工作
- [ ] 澄清UI能交互
- [ ] 至少2个新组件通过测试

#### ✅ Week 3 理想目标

- [ ] 泳道分组准确率 > 75%
- [ ] 骨架屏动画流畅 (60fps)
- [ ] 澄清交互成功率 > 85%

---

## Week 4: 集成测试 + 性能优化

**目标**: 端到端测试、安全防护、性能达标

### Day 1-2: 端到端测试

#### ✅ 任务4.1: 编写E2E测试

**文件**: `tests/e2e/ai-chat.spec.ts`

- [ ] 创建测试文件
- [ ] 测试完整对话流程
  - [ ] 发送查询 → 接收结果
  - [ ] 澄清交互 → 更新查询
  - [ ] 零结果 → 查看建议
- [ ] 测试错误处理
- [ ] 测试边界情况

**验收**:

- [ ] ✅ 至少3个E2E场景通过
- [ ] ✅ 主要用户路径覆盖
- [ ] ✅ 错误处理正确

---

#### ✅ 任务4.2: 手动测试清单

- [ ] 基础查询: "医疗图标"
- [ ] 复杂查询: "红色 3D 医疗 图标"
- [ ] 纠正: "不对，要蓝色的"
- [ ] 探索: "给我一些灵感"
- [ ] 零结果: "xxxxxx" (无意义)
- [ ] 澄清交互
- [ ] 移动端测试
- [ ] 性能测试

**验收**:

- [ ] ✅ 所有场景能完成
- [ ] ✅ 无崩溃/死循环
- [ ] ✅ 用户体验可接受

---

### Day 3-4: 安全防护

#### ✅ 任务4.3: 实现XML沙箱

**文件**: `lib/ai/zhipu-provider.ts` (修改)

- [ ] 修改System Prompt
- [ ] 添加XML标签包装
  ```typescript
  const userMessage = `<user_query>${rawInput}</user_query>`;
  ```
- [ ] 添加安全指令
- [ ] 测试注入攻击

**验收**:

- [ ] ✅ 注入攻击被阻止
- [ ] ✅ 正常查询不受影响
- [ ] ✅ 无安全漏洞

---

#### ✅ 任务4.4: 实现意图白名单

**文件**: `lib/ai/query-analyzer.ts` (增强)

- [ ] 定义允许意图列表
- [ ] 实现意图验证
- [ ] 添加阻止逻辑
- [ ] 测试异常输入

**验收**:

- [ ] ✅ 异常意图被识别
- [ ] ✅ 返回友好错误消息
- [ ] ✅ 不影响正常使用

---

### Day 5: 性能优化

#### ✅ 任务4.5: 性能基准测试

- [ ] 测试API响应时间 (p95)
- [ ] 测试向量搜索速度
- [ ] 测试AI生成速度
- [ ] 记录性能基线
- [ ] 识别瓶颈

**验收**:

- [ ] ✅ 建立性能基线
- [ ] ✅ 识别主要瓶颈
- [ ] ✅ 制定优化计划

---

#### ✅ 任务4.6: 实施关键优化

- [ ] 优化查询分析 (< 100ms)
- [ ] 优化向量搜索 (< 500ms)
- [ ] 实施流式响应
- [ ] 优化前端渲染
- [ ] 再次测试性能

**验收**:

- [ ] ✅ API响应时间 < 2秒 (p95)
- [ ] ✅ 资源加载时间 < 1秒 (p95)
- [ ] ✅ 用户感知流畅

---

### Week 4 最终验收

#### ✅ Week 4 必达目标

- [ ] 所有E2E测试通过
- [ ] 安全防护实施
- [ ] 性能达标 (< 2秒)
- [ ] MVP功能完整

#### ✅ Week 4 理想目标

- [ ] API响应时间 < 1.5秒
- [ ] 意图识别准确率 > 80%
- [ ] 零结果率 < 5%
- [ ] 用户满意度 > 4.0/5.0

---

## Week 5: 缓冲周 + 上线准备

**目标**: 处理延期、bug修复、文档

### 缓冲任务（按优先级）

#### 🔥 高优先级

- [ ] 修复Week 1-4发现的critical bug
- [ ] 完成未完成的必达目标
- [ ] 性能优化到达标

#### 🟡 中优先级

- [ ] 补充单元测试
- [ ] 代码审查和重构
- [ ] 添加错误日志

#### 🟢 低优先级

- [ ] 优化UI细节
- [ ] 添加动画效果
- [ ] 编写使用文档

---

### MVP 最终验收清单

#### ✅ 功能验收

- [ ] ✅ 能处理基础查询 ("医疗图标")
- [ ] ✅ 意图识别工作 (search/correction/inspiration)
- [ ] ✅ 澄清功能工作
- [ ] ✅ 零结果有建议
- [ ] ✅ 泳道分组展示
- [ ] ✅ 骨架屏加载
- [ ] ✅ 移动端基本可用

#### ✅ 性能验收

- [ ] ✅ API响应时间 < 2秒 (p95)
- [ ] ✅ 资源加载时间 < 1秒 (p95)
- [ ] ✅ 意图识别准确率 > 70%
- [ ] ✅ 零结果率 < 10%

#### ✅ 质量验收

- [ ] ✅ 关键路径E2E测试通过
- [ ] ✅ 单元测试覆盖率 > 60%
- [ ] ✅ 无critical级别bug
- [ ] ✅ 安全审查通过

#### ✅ 上线准备

- [ ] ✅ 环境变量配置正确
- [ ] ✅ 数据库备份正常
- [ ] ✅ 监控日志配置
- [ ] ✅ 回滚计划准备

---

## 🎯 MVP 关键指标追踪

| 指标               | 目标值  | 当前值 | 状态 | 测量方式          |
| ------------------ | ------- | ------ | ---- | ----------------- |
| 意图识别准确率     | ≥ 70%   | -      | ⏳   | 人工测试100个查询 |
| API响应时间 (p95)  | < 2s    | -      | ⏳   | 性能监控          |
| 资源加载时间 (p95) | < 1s    | -      | ⏳   | 性能监控          |
| 零结果率           | < 10%   | -      | ⏳   | 分析日志          |
| 澄清准确率         | ≥ 75%   | -      | ⏳   | 人工测试          |
| E2E测试通过率      | 100%    | -      | ⏳   | 测试报告          |
| 单元测试覆盖率     | ≥ 60%   | -      | ⏳   | Jest coverage     |
| 用户满意度 (内部)  | ≥ 4.0/5 | -      | ⏳   | 团队评分          |

---

## 📝 每日检查模板

### [日期] 每日进度

**本周目标**: [Week X 的目标]

#### ✅ 今日完成

- [ ] [具体任务1]
- [ ] [具体任务2]

#### ⚠️ 遇到的问题

- [问题1]: 描述 → [解决方案]
- [问题2]: 描述 → [待解决]

#### 📊 进度更新

- 完成任务数: X/Y
- 代码行数: +XXX
- 测试通过: X/X

#### 📅 明日计划

- [ ] [任务1]
- [ ] [任务2]

#### 💡 备注

- [任何其他信息]

---

## 🔥 问题升级路径

### 问题优先级定义

**P0 - 阻塞**:

- 环境无法搭建
- 核心API无法工作
- 数据无法加载
- **处理**: 立即处理，当天解决

**P1 - 高优先级**:

- 主要功能不工作
- 性能严重不达标
- 安全漏洞
- **处理**: 优先处理，2天内解决

**P2 - 中优先级**:

- 次要功能不工作
- 性能轻微不达标
- UI小问题
- **处理**: 正常处理，1周内解决

**P3 - 低优先级**:

- 优化建议
- 文档缺失
- 代码整洁度
- **处理**: 有时间再做

---

## 📞 资源与帮助

### 技术文档

- [技术实施规格](./technical-specification.md)
- [MVP启动指南](./MVP-KICKOFF.md)
- [完整检查清单](./checklist.md)

### 代码参考

- 现有实现: `lib/ai/`
- UI组件: `components/ai-chat/`
- API路由: `app/api/chat/`

### 外部资源

- [Next.js 文档](https://nextjs.org/docs)
- [Supabase 文档](https://supabase.com/docs)
- [智谱AI 文档](https://open.bigmodel.cn/dev/api)

---

## 🎉 MVP完成后

### 下一步（Phase 3+）

- [ ] 新用户引导系统
- [ ] 迭代优化功能
- [ ] 移动端手势优化
- [ ] A/B测试框架

### 文档更新

- [ ] 更新本checklist为100%
- [ ] 记录经验教训
- [ ] 更新technical-specification.md

---

**最后更新**: YYYY-MM-DD
**维护者**: @你
**状态**: 🚀 准备启动

---

**开始MVP开发吧！** 💪

第一步: 勾选 Week 1 Day 1 的第一个checkbox
第二步: `npm run dev`
第三步: 开始编码！
